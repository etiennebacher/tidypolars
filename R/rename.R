#' Rename columns
#'
#' @param .data A Polars Data/LazyFrame
#' @param ... For `rename()`, one of the following:
#' * params like `new_name = "old_name"` to rename selected variables.
#' * as above but params wrapped in a list
#'
#'  For `rename_with`, additional arguments passed to `fn`.
#' @param .fn Function to apply on column names
#' @param .cols Columns on which to apply `fn`. Can be anything accepted by
#'   `dplyr::select()`.
#'
#' @export
#' @examplesIf require("dplyr", quietly = TRUE) && require("tidyr", quietly = TRUE)
#' pl_test <- polars::pl$DataFrame(mtcars)
#'
#' rename(pl_test, miles_per_gallon = "mpg", horsepower = "hp")
#'
#' rename(pl_test, list(miles_per_gallon = "mpg", horsepower = "hp"))
#'
#' rename(pl_test, `Miles per gallon` = "mpg", `Horse power` = "hp")
#'
#' rename_with(pl_test, toupper, .cols = contains("p"))
#'
#' pl_test_2 <- polars::pl$DataFrame(iris)
#'
#' rename_with(pl_test_2, function(x) tolower(gsub(".", "_", x, fixed = TRUE)))
#'
#' rename_with(pl_test_2, \(x) tolower(gsub(".", "_", x, fixed = TRUE)))

rename.DataFrame <- function(.data, ...) {
  check_polars_data(.data)
  .data$rename(...)
}

#' @rdname rename.DataFrame
#' @export
rename.LazyFrame <- rename.DataFrame

#' @rdname rename.DataFrame
#' @export

rename_with.DataFrame <- function(.data, .fn, .cols = tidyselect::everything(), ...) {
  check_polars_data(.data)
  to_replace <- tidyselect_named_arg(.data, rlang::enquo(.cols))
  new <- do.call(.fn, list(to_replace, ...))
  mapping <- as.list(to_replace)
  names(mapping) <- new
  .data$rename(mapping)
}

#' @rdname rename.DataFrame
#' @export
rename_with.LazyFrame <- rename_with.DataFrame
