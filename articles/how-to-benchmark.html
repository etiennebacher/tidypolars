<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How to benchmark tidypolars • tidypolars</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to benchmark tidypolars">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidypolars</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.14.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tidypolars.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/how-to-benchmark.html">How to benchmark tidypolars</a></li>
    <li><a class="dropdown-item" href="../articles/r-and-polars-expressions.html">R and Polars expressions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/etiennebacher/tidypolars/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>How to benchmark tidypolars</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/etiennebacher/tidypolars/blob/main/vignettes/how-to-benchmark.Rmd" class="external-link"><code>vignettes/how-to-benchmark.Rmd</code></a></small>
      <div class="d-none name"><code>how-to-benchmark.Rmd</code></div>
    </div>

    
    
<p>Several blog posts and GitHub repos try to benchmark packages for
dataframe manipulation (<code>data.table</code>, <code>dplyr</code>,
<code>duckplyr</code>, etc.). When it comes to benchmarking
<code>tidypolars</code>, I have seen several implementation mistakes
that make the results quite unreliable. This is not to say that
<code>tidypolars</code> will always be faster than alternatives. In
fact, there is rarely one tool that is better than all the others in all
aspects of dataframe manipulation. The goal of this vignette is to give
some advice on how best to benchmark <code>tidypolars</code>.</p>
<p><strong>Summary:</strong> instead of this code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(dat) {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  my_polars_data <span class="ot">&lt;-</span> <span class="fu">as_polars_df</span>(dat)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  my_polars_data <span class="sc">|&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="er">&lt;</span>some slow operation<span class="sc">&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>}</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="fu">my_function</span>(my_r_data_frame)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>)</span></code></pre></div>
<p>use this code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>my_polars_data <span class="ot">&lt;-</span> <span class="fu">as_polars_lf</span>(my_r_data_frame)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(dat) {</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  my_polars_data <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="er">&lt;</span>some slow operation<span class="sc">&gt;</span> <span class="er">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="fu">compute</span>() <span class="co"># or compute(engine = "streaming")</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>}</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="fu">my_function</span>(my_polars_data)</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>)</span></code></pre></div>
<div class="section level2">
<h2 id="do-not-include-as_polars_df-or-as_polars_lf-in-the-timing">Do not include <code>as_polars_df()</code> or
<code>as_polars_lf()</code> in the timing<a class="anchor" aria-label="anchor" href="#do-not-include-as_polars_df-or-as_polars_lf-in-the-timing"></a>
</h2>
<p>Some benchmarks do something like the following:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(dat) {</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">as_polars_df</span>(dat)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  dat <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="er">&lt;</span>some slow operation<span class="sc">&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="fu">my_function</span>(my_r_data_frame)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>)</span></code></pre></div>
<p>The issue with this approach is that <code><a href="https://pola-rs.github.io/r-polars/man/as_polars_df.html" class="external-link">as_polars_df()</a></code>
converts the R <code>data.frame</code> to a Polars DataFrame, which
takes some time. As <a href="https://www.tidypolars.etiennebacher.com/articles/tidypolars#importing-data" class="external-link">highlighted</a>
in the “Getting started” vignette, <code><a href="https://pola-rs.github.io/r-polars/man/as_polars_df.html" class="external-link">as_polars_df()</a></code> and
<code><a href="https://pola-rs.github.io/r-polars/man/as_polars_lf.html" class="external-link">as_polars_lf()</a></code> are convenience functions for demo and
testing purposes. The recommended way to use <code>tidypolars</code> is
by using the dedicated readers (<code><a href="../reference/from_parquet.html">scan_parquet_polars()</a></code>,
<code><a href="../reference/from_parquet.html">read_parquet_polars()</a></code>, etc.) to import the data directly as
a Polars DataFrame or LazyFrame.</p>
<p>Using <code><a href="https://pola-rs.github.io/r-polars/man/as_polars_df.html" class="external-link">as_polars_df()</a></code> and <code><a href="https://pola-rs.github.io/r-polars/man/as_polars_lf.html" class="external-link">as_polars_lf()</a></code> is
fine to get the data ready to be benchmarked, but those operations
should not be included in the timing.</p>
</div>
<div class="section level2">
<h2 id="use-lazy-execution-when-possible">Use lazy execution when possible<a class="anchor" aria-label="anchor" href="#use-lazy-execution-when-possible"></a>
</h2>
<p>Polars provides DataFrames and LazyFrames. Operations on DataFrames
are executed in “eager mode”, meaning that there is no optimization
happening behind the scenes, for instance to efficiently reorder
operations. In real-life workflows, it is strongly recommended to use
LazyFrames since they allow for a large number of optimizations.</p>
<p>In benchmarks or demos, you should therefore prefer
<code><a href="https://pola-rs.github.io/r-polars/man/as_polars_lf.html" class="external-link">as_polars_lf()</a></code> over <code><a href="https://pola-rs.github.io/r-polars/man/as_polars_df.html" class="external-link">as_polars_df()</a></code>. Using
LazyFrames means that you also need to collect results to trigger
computation. This can be done using <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> (to return a
Polars DataFrame), <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> (to return an R
<code>data.frame</code>), or <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble()</a></code> (to return a
<code>tibble</code>).</p>
<p>Depending on the objective of the benchmark, each of the three
options can be valid. <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> is faster because it avoids
the extra step of converting a Polars DataFrame to R. However, the
output of <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> cannot be passed directly to
<code>ggplot2</code>, for example.</p>
<p>In summary, instead of doing:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>my_polars_data <span class="ot">&lt;-</span> <span class="fu">as_polars_df</span>(my_r_data_frame)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(dat) {</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  my_polars_data <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="er">&lt;</span>some slow operation<span class="sc">&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>}</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="fu">my_function</span>(my_polars_data)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>)</span></code></pre></div>
<p>you should do:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>my_polars_data <span class="ot">&lt;-</span> <span class="fu">as_polars_lf</span>(my_r_data_frame) <span class="co"># Use as_polars_lf()</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(dat) {</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  my_polars_data <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="er">&lt;</span>some slow operation<span class="sc">&gt;</span> <span class="er">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="fu">compute</span>() <span class="co"># Or collect() or as_tibble()</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>}</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="fu">my_function</span>(my_polars_data)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="use-streaming-mode-when-possible">Use streaming mode when possible<a class="anchor" aria-label="anchor" href="#use-streaming-mode-when-possible"></a>
</h2>
<p>In addition to lazy execution, Polars comes with a streaming engine
that is able to perform operations on larger-than-RAM data. It is also
faster than the default engine in many cases, not just with
larger-than-RAM data.</p>
<p><strong>Note:</strong> at the time of writing (August 2025), the
streaming engine is not yet used by default, but it should become the
default in the next few months.</p>
<p>Using it is extremely simple: pass <code>engine = "streaming"</code>
in <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> or
<code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="do-not-try-to-run-tidypolars-in-parallel">Do not try to run tidypolars in parallel<a class="anchor" aria-label="anchor" href="#do-not-try-to-run-tidypolars-in-parallel"></a>
</h2>
<p>Some benchmarks take advantage of tools such as <code>future</code>
or <code>mirai</code> to run code in parallel. However,
<code>tidypolars</code> shouldn’t be used with such tools. All
<code>polars</code> code that is used internally is already optimized to
run on all cores and isn’t guaranteed to play well with other parallel
frameworks.</p>
<p>In <a href="https://pola-rs.github.io/r-polars/vignettes/custom-functions.html#using-purrr" class="external-link">some
cases</a>, you may want to use those frameworks on Polars objects, but
this should be the exception rather than the rule.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.etiennebacher.com" class="external-link">Etienne Bacher</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
